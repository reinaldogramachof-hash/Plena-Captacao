<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plena Inform√°tica - Sistema de Capta√ß√£o de clientes</title>
<meta name="description" content="Sistema Inteligente de Capta√ß√£o da Plena Inform√°tica para prospec√ß√£o e gest√£o de clientes locais.">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- CSS principal -->
    <link rel="stylesheet" href="assets/css/main.css">

    <!-- CSS IA Prospec√ß√£o -->
    <link rel="stylesheet" href="assets/css/ia-prospecting.css">

    <!-- Font Awesome (√≠cones) -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Chart.js (gr√°ficos do dashboard e relat√≥rios) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon"
          href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
</head>

<body>
<div class="app-container">
    <!-- ========== SIDEBAR ========== -->
    <nav class="sidebar">
        <div class="logo">
            <h1>Plena Inform√°tica</h1>
            <p class="version">Sistema de Capta√ß√£o de Clientes</p>
        </div>

        <ul class="nav-menu">
            <li class="nav-item active" data-section="dashboard">
                <i class="fas fa-chart-network"></i>
                <span>Dashboard Overview</span>
            </li>
            <li class="nav-item" data-section="leads">
                <i class="fas fa-users"></i>
                <span>Gest√£o de Leads</span>
            </li>
            <li class="nav-item" data-section="strategies">
                <i class="fas fa-chess-knight"></i>
                <span>Estrat√©gias IA</span>
            </li>
            <li class="nav-item" data-section="reports">
                <i class="fas fa-chart-bar"></i>
                <span>Relat√≥rios Avan√ßados</span>
            </li>
            <li class="nav-item" data-section="alerts">
                <i class="fas fa-bell"></i>
                <span>Alertas</span>
                <span class="notification-badge" id="sidebarAlerts">0</span>
            </li>
        </ul>

        <div class="theme-toggle-container">
          <button class="theme-toggle" id="themeToggle" aria-label="Alternar entre modo claro e escuro">
    <span class="theme-icon">üåô</span>
    <span class="theme-label">Modo Claro</span>
</button> 
        </div>
    </nav>

    <!-- ========== √ÅREA PRINCIPAL ========== -->
    <main class="main-content" role="main">

        <!-- ===== HEADER FIXO NO TOPO ===== -->
        <header class="header">
            <!-- busca -->
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput"
                       placeholder="Buscar leads, estrat√©gias, relat√≥rios...">
            </div>

            <!-- a√ß√µes -->
            <div class="header-actions">
                <button class="btn btn-primary" onclick="openAddLeadModal()">
                    <i class="fas fa-plus"></i>
                    <span>Novo Lead</span>
                </button>

                <button class="btn btn-secondary" onclick="iaProspectingTrigger()">
                    <i class="fas fa-robot"></i>
                    <span>IA Prospec√ß√£o</span>
                </button>

                <div class="notification-wrapper">
                    <button class="notification-btn" id="notificationBtn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="headerAlerts">0</span>
                    </button>

                    <div class="notification-dropdown" id="notificationDropdown">
                        <div class="notification-header">
                            <h4>Central de Notifica√ß√µes</h4>
                            <button onclick="markAllAsRead()">Limpar todas</button>
                        </div>

                        <div class="notification-list" id="notificationList">
                            <!-- preenchido via JS -->
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ===== CONTE√öDO SCROLL√ÅVEL ===== -->
        <div class="content-area">

            <!-- ================= DASHBOARD ================= -->
            <section id="dashboard" class="section active">
                <div class="section-header">
                    <div>
                        <h1>Dashboard Overview</h1>
                        <p>Vis√£o completa do seu pipeline de prospec√ß√£o em S√£o Jos√© dos Campos</p>
                        <div class="dashboard-time" id="dashboardTime"></div>
                    </div>
                </div>

                <!-- M√©tricas principais -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-bullseye"></i></div>
                        <div class="stat-info">
                            <h3 id="totalLeads">0</h3>
                            <p>Leads Ativos</p>
                        </div>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i>
                            12%
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-fire"></i></div>
                        <div class="stat-info">
                            <h3 id="criticalLeads">0</h3>
                            <p>Leads Cr√≠ticos</p>
                        </div>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i>
                            8%
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-rocket"></i></div>
                        <div class="stat-info">
                            <h3 id="conversionRate">0%</h3>
                            <p>Taxa de Convers√£o</p>
                        </div>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i>
                            5%
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-clock"></i></div>
                        <div class="stat-info">
                            <h3 id="pendingActions">0</h3>
                            <p>A√ß√µes Pendentes</p>
                        </div>
                        <div class="stat-trend down">
                            <i class="fas fa-arrow-down"></i>
                            3%
                        </div>
                    </div>
                </div>

                <!-- Top Oportunidades (IA comercial) -->
                <div class="quick-actions" id="topOpportunitiesWrapper">
                    <h3><i class="fas fa-handshake"></i> Top Oportunidades do Dia</h3>
                    <div class="actions-grid" id="topOpportunities">
                        <!-- preenchido via main.js -->
                    </div>
                </div>

                <!-- ===== NOVO LAYOUT: GR√ÅFICOS EM LARGURA TOTAL ===== -->
                <div class="dashboard-full-content">
                    
                    <!-- Container de gr√°ficos em grid 2x2 -->
                    <div class="charts-grid-full">
                        <div class="chart-card-full">
                            <h3><i class="fas fa-chart-pie"></i> Distribui√ß√£o por Potencial</h3>
                            <canvas id="potentialChart"></canvas>
                        </div>

                        <div class="chart-card-full">
                            <h3><i class="fas fa-tags"></i> Leads por Nicho</h3>
                            <canvas id="nicheChart"></canvas>
                        </div>

                        <div class="chart-card-full">
                            <h3><i class="fas fa-chart-line"></i> Atividade Semanal</h3>
                            <canvas id="activityChart"></canvas>
                        </div>

                        <div class="chart-card-full">
                            <h3><i class="fas fa-trending-up"></i> Performance de Convers√£o</h3>
                            <canvas id="conversionChart"></canvas>
                        </div>
                    </div>

                    <!-- ===== A√á√ïES R√ÅPIDAS ABAIXO DOS GR√ÅFICOS ===== -->
                    <div class="quick-actions-full">
                        <div class="quick-actions-header">
                            <h3><i class="fas fa-bolt"></i> A√ß√µes R√°pidas do Sistema</h3>
                            <p>Acesse rapidamente as principais funcionalidades</p>
                        </div>

                        <div class="actions-grid-full">
                            <button class="action-card-full"
                                    onclick="plenaSystem.filterLeads && plenaSystem.filterLeads('critical')">
                                <div class="action-icon">
                                    <i class="fas fa-fire"></i>
                                </div>
                                <div class="action-content">
                                    <span class="action-title">Ver Leads Cr√≠ticos</span>
                                    <span class="action-desc">Priorize contatos urgentes</span>
                                </div>
                            </button>

                            <button class="action-card-full"
                                    onclick="iaProspectingTrigger()">
                                <div class="action-icon">
                                    <i class="fas fa-search-plus"></i>
                                </div>
                                <div class="action-content">
                                    <span class="action-title">Nova Busca IA</span>
                                    <span class="action-desc">Encontre leads potenciais</span>
                                </div>
                            </button>

                            <button class="action-card-full"
                                    onclick="showTodaysStrategy()">
                                <div class="action-icon">
                                    <i class="fas fa-chess-knight"></i>
                                </div>
                                <div class="action-content">
                                    <span class="action-title">Estrat√©gia do Dia</span>
                                    <span class="action-desc">Scripts atualizados</span>
                                </div>
                            </button>

                            <button class="action-card-full"
                                    onclick="generateQuickReport()">
                                <div class="action-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="action-content">
                                    <span class="action-title">Relat√≥rio R√°pido</span>
                                    <span class="action-desc">Resumo do desempenho</span>
                                </div>
                            </button>

                            <button class="action-card-full"
                                    onclick="iaAssistant.showScriptTemplates && iaAssistant.showScriptTemplates()">
                                <div class="action-icon">
                                    <i class="fas fa-scroll"></i>
                                </div>
                                <div class="action-content">
                                    <span class="action-title">Scripts de Liga√ß√£o</span>
                                    <span class="action-desc">Modelos prontos</span>
                                </div>
                            </button>

                            <button class="action-card-full"
                                    onclick="testNotificationSystem()">
                                <div class="action-icon">
                                    <i class="fas fa-bell"></i>
                                </div>
                                <div class="action-content">
                                    <span class="action-title">Testar Notifica√ß√£o</span>
                                    <span class="action-desc">Verifique o sistema</span>
                                </div>
                            </button>
                        </div>
                    </div>

                </div>
            </section>

            <!-- ================= LEADS ================= -->
            <section id="leads" class="section">
                <div class="section-header">
                    <h2>Gest√£o de Leads</h2>
                    <p>Gerencie todos os seus potenciais clientes em S√£o Jos√© dos Campos</p>

                    <div class="leads-stats">
                        <div class="stat-mini">
                            <span class="stat-number" id="leadsTotal">0</span>
                            <span class="stat-label">Total</span>
                        </div>
                        <div class="stat-mini">
                            <span class="stat-number" id="leadsContacted">0</span>
                            <span class="stat-label">Contactados</span>
                        </div>
                        <div class="stat-mini">
                            <span class="stat-number" id="leadsNeverContacted">0</span>
                            <span class="stat-label">N√£o Contactados</span>
                        </div>
                    </div>

                    <div class="filters">
                        <button class="filter-btn active" data-filter="all">Todos</button>
                        <button class="filter-btn" data-filter="critical">Cr√≠ticos</button>
                        <button class="filter-btn" data-filter="high">Alto Potencial</button>
                        <button class="filter-btn" data-filter="never-contacted">N√£o Contactados</button>
                        <button class="filter-btn" data-filter="recent">Recentes</button>
                    </div>
                </div>

                <div class="leads-grid" id="leadsContainer">
                    <!-- cards de leads via main.js -->
                </div>
            </section>

            <!-- ================= ESTRAT√âGIAS ================= -->
            <section id="strategies" class="section">
                <div class="section-header">
                    <h2>Estrat√©gias de Prospec√ß√£o IA</h2>
                    <p>Scripts e estrat√©gias inteligentes por nicho de atua√ß√£o</p>
                </div>

                <div class="ai-recommendations">
                    <div class="ai-header">
                        <i class="fas fa-robot"></i>
                        <h3>Estrat√©gias por Nicho - S√£o Jos√© dos Campos</h3>
                        <button class="btn btn-sm" onclick="iaAssistant.generatePerformanceReport && iaAssistant.generatePerformanceReport()">
                            <i class="fas fa-chart-bar"></i> Relat√≥rio
                        </button>
                    </div>

                    <div class="recommendations-grid">
                        <div class="recommendation-card">
                            <h4>üë®‚Äç‚öïÔ∏è Profissionais Liberais</h4>
                            <p><strong>Abordagem:</strong> "Profissionais da sua √°rea com presen√ßa digital conseguem at√© 40% mais agendamentos. Posso te mostrar como aplicar isso no seu consult√≥rio?"</p>
                            <p><strong>Argumento-chave:</strong> Agendamento online 24h + Autoridade</p>
                            <p><strong>Estat√≠stica:</strong> 42% de taxa de convers√£o</p>
                        </div>

                        <div class="recommendation-card">
                            <h4>üîß Servi√ßos Especializados</h4>
                            <p><strong>Abordagem:</strong> "Neg√≥cios que aparecem no Google em 'emerg√™ncia' conseguem 3x mais chamadas. Vamos posicionar o seu assim?"</p>
                            <p><strong>Argumento-chave:</strong> Urg√™ncia local + Resposta r√°pida</p>
                            <p><strong>Estat√≠stica:</strong> 38% de taxa de convers√£o</p>
                        </div>

                        <div class="recommendation-card">
                            <h4>üè™ Com√©rcio Local</h4>
                            <p><strong>Abordagem:</strong> "Seus produtos s√£o bons, mas voc√™ est√° fechado √† noite. E-commerce deixa sua vitrine aberta 24h."</p>
                            <p><strong>Argumento-chave:</strong> Vendas fora do hor√°rio</p>
                            <p><strong>Estat√≠stica:</strong> 35% de taxa de convers√£o</p>
                        </div>

                        <div class="recommendation-card">
                            <h4>üí™ Sa√∫de e Bem-estar</h4>
                            <p><strong>Abordagem:</strong> "Muita gente pesquisa primeiro online antes de visitar. Vamos fazer voc√™ ser a primeira op√ß√£o que aparece?"</p>
                            <p><strong>Argumento-chave:</strong> Capta√ß√£o cont√≠nua + Agendamento direto</p>
                            <p><strong>Estat√≠stica:</strong> 45% de taxa de convers√£o</p>
                        </div>
                    </div>
                </div>

                <div class="quick-actions">
                    <h3><i class="fas fa-tools"></i> Ferramentas de Apoio</h3>

                    <div class="actions-grid">
                        <button class="action-card"
                                onclick="iaAssistant.showScriptTemplates && iaAssistant.showScriptTemplates()">
                            <i class="fas fa-scroll"></i>
                            <span>Scripts de Liga√ß√£o</span>
                        </button>

                        <button class="action-card"
                                onclick="iaAssistant.showEmailTemplates && iaAssistant.showEmailTemplates()">
                            <i class="fas fa-envelope"></i>
                            <span>Templates de Email</span>
                        </button>

                        <button class="action-card"
                                onclick="iaAssistant.showObjectionHandling && iaAssistant.showObjectionHandling()">
                            <i class="fas fa-comments"></i>
                            <span>Tratativa de Obje√ß√µes</span>
                        </button>

                        <button class="action-card"
                                onclick="iaAssistant.showROICalculator && iaAssistant.showROICalculator()">
                            <i class="fas fa-calculator"></i>
                            <span>Calculadora de ROI</span>
                        </button>

                        <button class="action-card"
                                onclick="iaAssistant.exportIAData && iaAssistant.exportIAData()">
                            <i class="fas fa-download"></i>
                            <span>Exportar Dados IA</span>
                        </button>

                        <button class="action-card"
                                style="border-color: var(--danger);"
                                onclick="iaAssistant.resetIAData && iaAssistant.resetIAData()">
                            <i class="fas fa-redo"></i>
                            <span>Resetar IA</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- ================= RELAT√ìRIOS ================= -->
            <section id="reports" class="section">
                <div class="section-header">
                    <h2>Relat√≥rios Avan√ßados</h2>
                    <p>An√°lises detalhadas e m√©tricas de performance</p>

                    <div class="filters">
                        <button class="filter-btn active" data-report="overview">Vis√£o Geral</button>
                        <button class="filter-btn" data-report="performance">Desempenho</button>
                        <button class="filter-btn" data-report="conversion">Convers√£o</button>
                        <button class="filter-btn" data-report="niche">Por Nicho</button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="stat-info">
                            <h3 id="reportTotalLeads">0</h3>
                            <p>Total de Leads</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-target"></i></div>
                        <div class="stat-info">
                            <h3 id="reportConversion">0%</h3>
                            <p>Taxa de Convers√£o</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-clock"></i></div>
                        <div class="stat-info">
                            <h3 id="reportResponseTime">0h</h3>
                            <p>Tempo M√©dio de Resposta</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-money-bill-wave"></i></div>
                        <div class="stat-info">
                            <h3 id="reportPotential">R$ 0</h3>
                            <p>Potencial Financeiro</p>
                        </div>
                    </div>
                </div>

                <div class="charts-container">
                    <div class="chart-card">
                        <h3><i class="fas fa-chart-bar"></i> Evolu√ß√£o de Leads por M√™s</h3>
                        <canvas id="monthlyLeadsChart"></canvas>
                    </div>

                    <div class="chart-card">
                        <h3><i class="fas fa-tachometer-alt"></i> Desempenho por Nicho</h3>
                        <canvas id="performanceChart"></canvas>
                    </div>

                    <div class="chart-card">
                        <h3><i class="fas fa-funnel-dollar"></i> Funil de Convers√£o</h3>
                        <canvas id="funnelChart"></canvas>
                    </div>

                    <div class="chart-card">
                        <h3><i class="fas fa-calendar-alt"></i> Atividade por Per√≠odo</h3>
                        <canvas id="timelineChart"></canvas>
                    </div>
                </div>

                <div class="quick-actions">
                    <h3><i class="fas fa-download"></i> Exportar Relat√≥rios</h3>

                    <div class="actions-grid">
                        <button class="action-card"
                                onclick="generateQuickReport()">
                            <i class="fas fa-file-pdf"></i>
                            <span>Relat√≥rio PDF</span>
                        </button>

                        <button class="action-card"
                                onclick="exportLeadsData()">
                            <i class="fas fa-file-csv"></i>
                            <span>Dados em CSV</span>
                        </button>

                        <button class="action-card"
                                onclick="iaAssistant.exportIAData && iaAssistant.exportIAData()">
                            <i class="fas fa-file-code"></i>
                            <span>Dados da IA</span>
                        </button>

                        <button class="action-card"
                                onclick="notificationSystem.exportNotifications && notificationSystem.exportNotifications()">
                            <i class="fas fa-bell"></i>
                            <span>Notifica√ß√µes</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- ================= ALERTAS ================= -->
            <section id="alerts" class="section">
                <div class="section-header">
                    <h2>Central de Alertas</h2>
                    <p>Notifica√ß√µes inteligentes e a√ß√µes pendentes</p>

                    <div class="filters">
                        <button class="filter-btn active" data-alert-type="all">Todos</button>
                        <button class="filter-btn" data-alert-type="urgent">Urgentes</button>
                        <button class="filter-btn" data-alert-type="reminder">Lembretes</button>
                        <button class="filter-btn" data-alert-type="success">Conclu√≠dos</button>
                    </div>
                </div>

                <div class="ai-recommendations">
                    <div class="ai-header">
                        <i class="fas fa-bell"></i>
                        <h3>Alertas Ativos</h3>

                        <div class="header-actions">
                            <button class="btn btn-sm"
                                    onclick="notificationSystem.cleanupOldNotifications && notificationSystem.cleanupOldNotifications()">
                                <i class="fas fa-trash"></i>
                                Limpar Antigos
                            </button>

                            <button class="btn btn-sm"
                                    onclick="notificationSystem.clearAllNotifications && notificationSystem.clearAllNotifications()">
                                <i class="fas fa-broom"></i>
                                Limpar Todos
                            </button>
                        </div>
                    </div>

                    <div id="alertsContainer">
                        <!-- alertas via notifications.js -->
                    </div>
                </div>

                <div class="quick-actions">
                    <h3><i class="fas fa-cog"></i> Configura√ß√µes de Notifica√ß√£o</h3>

                    <div class="actions-grid">
                        <button class="action-card"
                                onclick="notificationSystem.checkPendingActions && notificationSystem.checkPendingActions()">
                            <i class="fas fa-sync"></i>
                            <span>Verificar A√ß√µes Pendentes</span>
                        </button>

                        <button class="action-card"
                                onclick="markAllAsRead()">
                            <i class="fas fa-check-double"></i>
                            <span>Marcar Todas como Lidas</span>
                        </button>

                        <button class="action-card"
                                onclick="testNotificationSystem()">
                            <i class="fas fa-bell"></i>
                            <span>Testar Notifica√ß√£o</span>
                        </button>

                        <button class="action-card"
                                onclick="notificationSystem.addDailyGoalNotification && notificationSystem.addDailyGoalNotification()">
                            <i class="fas fa-bullseye"></i>
                            <span>Meta do Dia</span>
                        </button>

                        <button class="action-card"
                                onclick="notificationSystem.exportNotifications && notificationSystem.exportNotifications()">
                            <i class="fas fa-download"></i>
                            <span>Exportar Notifica√ß√µes</span>
                        </button>

                        <button class="action-card"
                                onclick="showNotification('Sistema','Notifica√ß√£o de teste do sistema','success')">
                            <i class="fas fa-check-circle"></i>
                            <span>Teste de Sucesso</span>
                        </button>
                    </div>
                </div>
            </section>

        </div> <!-- /content-area -->
    </main>
    
</div> <!-- /app-container -->

<!-- ========== MODAL IA PROSPEC√á√ÉO ========== -->
<div id="iaProspectModal" class="ia-prospect-modal">
    <div class="ia-prospect-content">
        <div class="ia-prospect-header">
            <h3><i class="fas fa-robot"></i> IA de Prospec√ß√£o Inteligente</h3>
            <button class="ia-close-btn" onclick="closeIaProspectModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="ia-prospect-body">
            <div class="search-config">
                <div class="form-group">
                    <label><i class="fas fa-tag"></i> Nicho de Busca</label>
                    <select id="prospectNiche" class="form-control">
                        <option value="Profissionais Liberais">üë®‚Äç‚öïÔ∏è Profissionais Liberais</option>
                        <option value="Servi√ßos Especializados">üîß Servi√ßos Especializados</option>
                        <option value="Com√©rcio Local">üè™ Com√©rcio Local</option>
                        <option value="Sa√∫de e Bem-estar">üí™ Sa√∫de e Bem-estar</option>
                        <option value="Beleza e Est√©tica">üíÖ Beleza e Est√©tica</option>
                        <option value="Alimenta√ß√£o">üçï Alimenta√ß√£o</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-map-marker-alt"></i> Localiza√ß√£o</label>
                    <input type="text" id="prospectLocation" class="form-control" 
                           value="S√£o Jos√© dos Campos" placeholder="Digite a cidade...">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-filter"></i> Filtros Avan√ßados</label>
                    <div class="filters-grid">
                        <label class="filter-option">
                            <input type="checkbox" id="filterDigital" checked>
                            <span>Presen√ßa Digital Fraca</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" id="filterRecent" checked>
                            <span>Neg√≥cios Recentes</span>
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" id="filterHighPotential">
                            <span>Alto Potencial</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="search-results" id="prospectResults">
                <div class="results-placeholder">
                    <i class="fas fa-search"></i>
                    <p>Configure os filtros e clique em "Iniciar Busca IA" para encontrar leads potenciais</p>
                </div>
            </div>
        </div>
        
        <div class="ia-prospect-footer">
            <button class="btn btn-outline" onclick="closeIaProspectModal()">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn btn-primary" onclick="startIaProspecting()">
                <i class="fas fa-play"></i> Iniciar Busca IA
            </button>
        </div>
    </div>
</div>

<!-- ========== MODAIS EXISTENTES ========== -->
<!-- Modal: Novo Lead -->
<div class="modal" id="addLeadModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-plus"></i> Cadastrar Novo Lead</h3>
            <button class="btn btn-outline"
                    onclick="closeModal('addLeadModal')"
                    style="color: white; border-color: white;">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="modal-body">
            <div class="form-group">
                <label><i class="fas fa-building"></i> Nome do Estabelecimento *</label>
                <input type="text" class="form-control" id="newLeadName"
                       placeholder="Ex: Padaria S√£o Jos√©">
            </div>

            <div class="form-group">
                <label><i class="fas fa-tag"></i> Nicho *</label>
                <select class="form-control" id="newLeadNiche">
                    <option value="">Selecione um nicho</option>
                    <option value="Profissionais Liberais">üë®‚Äç‚öïÔ∏è Profissionais Liberais</option>
                    <option value="Servi√ßos Especializados">üîß Servi√ßos Especializados</option>
                    <option value="Com√©rcio Local">üè™ Com√©rcio Local</option>
                    <option value="Sa√∫de e Bem-estar">üí™ Sa√∫de e Bem-estar</option>
                    <option value="Beleza e Est√©tica">üíÖ Beleza e Est√©tica</option>
                    <option value="Alimenta√ß√£o">üçï Alimenta√ß√£o</option>
                    <option value="Educa√ß√£o">üéì Educa√ß√£o</option>
                    <option value="Constru√ß√£o Civil">üèóÔ∏è Constru√ß√£o Civil</option>
                </select>
            </div>

            <div class="form-group">
                <label><i class="fas fa-map-marker-alt"></i> Endere√ßo *</label>
                <input type="text" class="form-control" id="newLeadAddress"
                       placeholder="Ex: Rua das Flores, 123 - Centro, S√£o Jos√© dos Campos">
            </div>

            <div class="form-group">
                <label><i class="fas fa-phone"></i> Telefone *</label>
                <input type="text" class="form-control" id="newLeadContact"
                       placeholder="Ex: (12) 3456-7890">
            </div>

            <div class="form-group">
                <label><i class="fas fa-globe"></i> Presen√ßa Digital (site / Instagram / Google Perfil)</label>
                <input type="text" class="form-control" id="newLeadDigital"
                       placeholder="Ex: instagram.com/padariasaojose | www.padariasaojose.com.br">
            </div>

            <div class="form-group">
                <label><i class="fas fa-sticky-note"></i> Observa√ß√µes Iniciais</label>
                <textarea class="form-control" id="newLeadNotes"
                          placeholder="Situa√ß√£o digital atual, potencial observado, obje√ß√µes prov√°veis..."
                          rows="3"></textarea>
            </div>

            <div class="form-actions">
                <button class="btn btn-primary" onclick="addNewLead()">
                    <i class="fas fa-plus"></i>
                    <span>Cadastrar Lead</span>
                </button>

                <button class="btn btn-outline"
                        onclick="closeModal('addLeadModal')">
                    <i class="fas fa-times"></i>
                    <span>Cancelar</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Lead Details -->
<div class="modal" id="leadDetailsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="leadDetailsTitle">
                <i class="fas fa-user"></i>
                Detalhes do Lead
            </h3>

            <button class="btn btn-outline"
                    onclick="closeModal('leadDetailsModal')"
                    style="color:white; border-color:white;">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="modal-body">
            <div class="form-group">
                <label><i class="fas fa-sticky-note"></i> Observa√ß√µes do Contato</label>
                <textarea class="form-control" id="contactNotes"
                          placeholder="Registre obje√ß√µes, pr√≥ximos passos, gatilho de urg√™ncia..."
                          rows="4"></textarea>
            </div>

            <div class="form-group">
                <label><i class="fas fa-tasks"></i> Status do Contato</label>
                <select class="form-control" id="contactStatus">
                    <option value="pending">‚è≥ Pendente</option>
                    <option value="contacted">üìû Contactado</option>
                    <option value="meeting_scheduled">üìÖ Reuni√£o Agendada</option>
                    <option value="proposal_sent">üì® Proposta Enviada</option>
                    <option value="negotiation">üíº Em Negocia√ß√£o</option>
                    <option value="closed_won">‚úÖ Fechado - Ganho</option>
                    <option value="closed_lost">‚ùå Fechado - Perdido</option>
                </select>
            </div>

            <div class="form-group">
                <label><i class="fas fa-calendar-check"></i> Pr√≥ximo Follow-up</label>
                <input type="datetime-local" class="form-control" id="nextFollowup">
            </div>

            <div class="form-actions">
                <button class="btn btn-primary" onclick="saveLeadDetails()">
                    <i class="fas fa-save"></i>
                    <span>Salvar Altera√ß√µes</span>
                </button>

                <button class="btn btn-outline"
                        onclick="closeModal('leadDetailsModal')">
                    <i class="fas fa-times"></i>
                    <span>Cancelar</span>
                </button>
            </div>

            <div class="timeline" id="timeline">
                <h4><i class="fas fa-history"></i> Hist√≥rico de Contato</h4>
                <div class="timeline-content" id="timelineContent">
                    <!-- hist√≥rico via main.js -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========== SCRIPTS PRINCIPAIS ========== -->
<script src="assets/js/theme.js"></script>
<script src="assets/js/ia-engine.js"></script>
<script src="assets/js/notifications.js"></script>
<script src="assets/js/main.js"></script>

<!-- Bots Inteligentes -->
<script src="assets/js/mission-bot.js"></script>
<script src="assets/js/ia-prospecting.js"></script>

<script>
/* ==== FUN√á√ïES GLOBAIS AUXILIARES ==== */

function iaProspectingTrigger() {
    const modal = document.getElementById('iaProspectModal');
    if (modal) {
        modal.classList.add('open');
    } else {
        alert('M√≥dulo IA Prospecting n√£o carregado.');
    }
}

function closeIaProspectModal() {
    const modal = document.getElementById('iaProspectModal');
    if (modal) {
        modal.classList.remove('open');
    }
}

function startIaProspecting() {
    if (window.iaProspecting && window.iaProspecting.startProspecting) {
        window.iaProspecting.startProspecting();
    } else {
        alert('Sistema de prospec√ß√£o IA n√£o inicializado.');
    }
}

function openAddLeadModal() {
    document.getElementById('addLeadModal').style.display = 'flex';
    document.getElementById('newLeadName').focus();
}

function closeModal(id) {
    document.getElementById(id).style.display = 'none';
}

function closeAllModals() {
    document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
    const iaModal = document.getElementById('iaProspectModal');
    if (iaModal) iaModal.classList.remove('open');
}

// ... (restante das fun√ß√µes globais permanecem iguais)
function addNewLead() {
    const name = document.getElementById('newLeadName').value.trim();
    const niche = document.getElementById('newLeadNiche').value;
    const address = document.getElementById('newLeadAddress').value.trim();
    const contact = document.getElementById('newLeadContact').value.trim();
    const digital = document.getElementById('newLeadDigital').value.trim();
    const notes = document.getElementById('newLeadNotes').value.trim();

    if (!name || !niche || !address || !contact) {
        showNotification('Erro', 'Preencha todos os campos obrigat√≥rios.', 'error');
        return;
    }

    if (window.plenaSystem) {
        const newLead = {
            id: Date.now(),
            name: name.toUpperCase(),
            niche: niche,
            address: address,
            contact: contact,
            digitalPresence: digital,
            potential: calculateInitialPotential(niche, notes),
            status: 'high',
            category: niche,
            conversionProbability: calculateInitialProbability(niche),
            notes: notes,
            lastContact: 'Nunca',
            nextAction: 'Primeiro contato',
            contactHistory: [],
            contactStatus: 'pending',
            createdAt: new Date().toISOString()
        };

        window.plenaSystem.leads.unshift(newLead);
        window.plenaSystem.saveLeads();
        window.plenaSystem.loadDashboardData();
        window.plenaSystem.loadLeadsData();

        closeModal('addLeadModal');
        showNotification('Sucesso', `Lead "${name}" cadastrado com sucesso!`, 'success');

        // sugest√£o IA
        if (window.iaAssistant && window.iaAssistant.generateStrategy) {
            setTimeout(() => {
                const strategy = window.iaAssistant.generateStrategy(newLead);
                showNotification(
                    'üéØ Estrat√©gia da IA',
                    `Estrat√©gia gerada para ${name}. Use o script: "${strategy.scriptLigacao.substring(0, 100)}..."`,
                    'info'
                );
            }, 800);
        }

        // limpar form
        document.getElementById('newLeadName').value = '';
        document.getElementById('newLeadNiche').value = '';
        document.getElementById('newLeadAddress').value = '';
        document.getElementById('newLeadContact').value = '';
        document.getElementById('newLeadDigital').value = '';
        document.getElementById('newLeadNotes').value = '';
    }
}

function calculateInitialPotential(niche, notes) {
    const nichePotential = {
        'Profissionais Liberais': 5,
        'Servi√ßos Especializados': 4,
        'Sa√∫de e Bem-estar': 4,
        'Com√©rcio Local': 3,
        'Beleza e Est√©tica': 3,
        'Alimenta√ß√£o': 3,
        'Educa√ß√£o': 4,
        'Constru√ß√£o Civil': 3
    };
    return nichePotential[niche] || 3;
}

function calculateInitialProbability(niche) {
    const baseProbabilities = {
        'Profissionais Liberais': 75,
        'Servi√ßos Especializados': 70,
        'Sa√∫de e Bem-estar': 80,
        'Com√©rcio Local': 60,
        'Beleza e Est√©tica': 65,
        'Alimenta√ß√£o': 55,
        'Educa√ß√£o': 70,
        'Constru√ß√£o Civil': 60
    };
    return baseProbabilities[niche] || 50;
}

function saveLeadDetails() {
    showNotification('Sistema', 'Detalhes do lead salvos com sucesso!', 'success');
    closeModal('leadDetailsModal');
}

function showTodaysStrategy() {
    if (window.iaAssistant && window.iaAssistant.generateStrategy) {
        const strategy = window.iaAssistant.generateStrategy({
            nicho: 'Profissionais Liberais',
            name: 'Lead do Dia'
        });

        alert(
`üéØ ESTRAT√âGIA DO DIA - Profissionais Liberais

${strategy.scriptLigacao}

üìß Email:
${strategy.emailTemplate.substring(0,200)}...`
        );
    }
}

function generateQuickReport() {
    if (!window.plenaSystem) return;

    const totalLeads = window.plenaSystem.leads.length;
    const criticalLeads = window.plenaSystem.leads.filter(l => l.status === 'critical').length;
    const contactedLeads = window.plenaSystem.leads.filter(l => l.lastContact !== 'Nunca').length;
    const conversionState = window.plenaSystem.leads.filter(l =>
        l.contactStatus === 'closed_won' || l.contactStatus === 'negotiation'
    ).length;

    alert(
        `üìä RELAT√ìRIO R√ÅPIDO - ${new Date().toLocaleDateString('pt-BR')}\n\n` +
        `‚Ä¢ Total de Leads: ${totalLeads}\n` +
        `‚Ä¢ Leads Cr√≠ticos: ${criticalLeads}\n` +
        `‚Ä¢ Leads Contactados: ${contactedLeads}\n` +
        `‚Ä¢ Em Negocia√ß√£o: ${conversionState}\n` +
        `‚Ä¢ Taxa de Contato: ${
            totalLeads > 0 ? Math.round((contactedLeads / totalLeads) * 100) : 0
        }%\n\n` +
        `üí° Pr√≥ximas A√ß√µes:\n` +
        `- Focar nos ${criticalLeads} leads cr√≠ticos\n` +
        `- Contactar ${totalLeads - contactedLeads} leads pendentes\n` +
        `- Acompanhar ${conversionState} negocia√ß√µes`
    );
}

function exportLeadsData() {
    if (!window.plenaSystem || window.plenaSystem.leads.length === 0) {
        showNotification('Exporta√ß√£o', 'Nenhum lead para exportar', 'warning');
        return;
    }

    const data = {
        exportedAt: new Date().toISOString(),
        totalLeads: window.plenaSystem.leads.length,
        leads: window.plenaSystem.leads
    };

    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `leads-plena-${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);

    showNotification('Exporta√ß√£o', 'Dados dos leads exportados com sucesso!', 'success');
}

function testNotificationSystem() {
    if (window.notificationSystem && window.notificationSystem.showSuccessNotification) {
        window.notificationSystem.showSuccessNotification(
            'Teste de Notifica√ß√£o',
            'Isso √© apenas um teste visual.'
        );
    }
}

/* ===== Inicializa√ß√£o ===== */
document.addEventListener('DOMContentLoaded', () => {
    console.log('üöÄ Sistema Inteligente de Capta√ß√£o carregado.');

    const systems = ['plenaSystem', 'notificationSystem', 'themeManager', 'iaAssistant'];
    const loaded = systems.filter(s => window[s]);
    console.log('‚úÖ Sistemas carregados:', loaded.join(', '));

    if (window.notificationSystem && window.notificationSystem.showInfoNotification) {
        setTimeout(() => {
            window.notificationSystem.showInfoNotification(
                'Sistema Inteligente de Capta√ß√£o',
                'Pipeline ativo. Abra o painel Miss√£o do Dia e execute as prioridades.'
            );
        }, 1000);
    }

    // atalhos
    document.addEventListener('keydown', e => {
        if (e.ctrlKey && e.key === 'n') {
            e.preventDefault();
            openAddLeadModal();
        }
        if (e.ctrlKey && e.key === 'f') {
            e.preventDefault();
            document.getElementById('searchInput').focus();
        }
        if (e.ctrlKey && e.key === 'r') {
            e.preventDefault();
            generateQuickReport();
        }
    });

    // service worker futuro
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').catch(console.error);
    }
});

/* ===== Eventos globais ===== */
window.addEventListener('error', e => {
    console.error('Erro global:', e.error);
    if (window.notificationSystem && window.notificationSystem.showErrorNotification) {
        window.notificationSystem.showErrorNotification(
            'Erro no Sistema',
            'Ocorreu um erro inesperado. Recarregue se persistir.'
        );
    }
});

window.addEventListener('online', () => {
    if (window.notificationSystem && window.notificationSystem.showSuccessNotification) {
        window.notificationSystem.showSuccessNotification(
            'Conex√£o Restaurada',
            'Sistema sincronizado com sucesso.'
        );
    }
});

window.addEventListener('offline', () => {
    if (window.notificationSystem && window.notificationSystem.showWarningNotification) {
        window.notificationSystem.showWarningNotification(
            'Modo Offline',
            'Algumas fun√ß√µes podem estar limitadas. Seus dados locais est√£o seguros.'
        );
    }
});

/* ===== Debug Helper ===== */
window.debugSystem = function () {
    return {
        plenaSystem: window.plenaSystem,
        notificationSystem: window.notificationSystem,
        themeManager: window.themeManager,
        iaAssistant: window.iaAssistant,
        iaProspecting: window.iaProspecting,
        version: 'si-capta√ß√£o-2025'
    };
};
</script>

<!-- ===== ESTILOS PARA O NOVO LAYOUT DO DASHBOARD ===== -->
<style>
/* ===== NOVO LAYOUT DASHBOARD ===== */
.dashboard-full-content {
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
}

/* Grid de gr√°ficos em largura total */
.charts-grid-full {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 25px;
    margin-bottom: 40px;
}

.chart-card-full {
    background: var(--bg-card);
    padding: 25px;
    border-radius: 16px;
    box-shadow: var(--shadow);
    transition: all 0.25s ease;
    border: 1px solid var(--border-color);
    min-height: 320px;
    display: flex;
    flex-direction: column;
}

.chart-card-full:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.chart-card-full h3 {
    margin-bottom: 20px;
    color: var(--text-primary);
    font-size: 1.15em;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.chart-card-full h3 i {
    color: var(--secondary);
}

.chart-card-full canvas {
    flex: 1;
    width: 100% !important;
    height: 250px !important;
    max-height: 250px;
}

/* A√ß√µes r√°pidas em largura total */
.quick-actions-full {
    background: var(--bg-card);
    padding: 30px;
    border-radius: 16px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border-color);
    margin-bottom: 30px;
}

.quick-actions-header {
    text-align: center;
    margin-bottom: 30px;
}

.quick-actions-header h3 {
    font-size: 1.4em;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.quick-actions-header p {
    color: var(--text-secondary);
    font-size: 1em;
}

.actions-grid-full {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
}

.action-card-full {
    background: var(--bg-secondary);
    border: 2px solid var(--border-color);
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.25s ease;
    display: flex;
    align-items: center;
    gap: 15px;
    text-align: left;
    position: relative;
    overflow: hidden;
    min-height: 80px;
}

.action-card-full:hover {
    border-color: var(--secondary);
    transform: translateY(-3px);
    box-shadow: var(--shadow);
    background: rgba(255,107,53,0.03);
}

.action-icon {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2em;
    flex-shrink: 0;
    transition: transform 0.25s ease;
}

.action-card-full:hover .action-icon {
    transform: scale(1.1);
}

.action-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.action-title {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.95em;
}

.action-desc {
    color: var(--text-secondary);
    font-size: 0.85em;
}

/* Responsividade para o novo layout */
@media (max-width: 1200px) {
    .charts-grid-full {
        grid-template-columns: 1fr;
    }
    
    .actions-grid-full {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }
}

@media (max-width: 768px) {
    .charts-grid-full {
        gap: 20px;
    }
    
    .chart-card-full {
        padding: 20px;
        min-height: 280px;
    }
    
    .quick-actions-full {
        padding: 20px;
    }
    
    .actions-grid-full {
        grid-template-columns: 1fr;
    }
    
    .action-card-full {
        padding: 15px;
    }
    
    .action-icon {
        width: 45px;
        height: 45px;
        font-size: 1.1em;
    }
}

@media (max-width: 480px) {
    .chart-card-full {
        padding: 15px;
        min-height: 250px;
    }
    
    .quick-actions-full {
        padding: 15px;
    }
    
    .action-card-full {
        flex-direction: column;
        text-align: center;
        gap: 10px;
        padding: 20px 15px;
    }
    
    .action-content {
        align-items: center;
    }
}

/* Remove o layout antigo do dashboard */
.dashboard-content {
    display: none;
}
</style>

</body>
</html>